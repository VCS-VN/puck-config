"use strict";function vt(b,j){for(var w=0;w<j.length;w++){const d=j[w];if(typeof d!="string"&&!Array.isArray(d)){for(const f in d)if(f!=="default"&&!(f in b)){const C=Object.getOwnPropertyDescriptor(d,f);C&&Object.defineProperty(b,f,C.get?C:{enumerable:!0,get:()=>d[f]})}}}return Object.freeze(Object.defineProperty(b,Symbol.toStringTag,{value:"Module"}))}var $={};(function(){var b=tinymce.util.Tools.resolve("tinymce.PluginManager");const j=e=>t=>e===t,w=j(null),d=j(void 0),f=e=>e==null,C=e=>!f(e),I=()=>{},M=(e=>()=>e)(!1);class a{constructor(t,n){this.tag=t,this.value=n}static some(t){return new a(!0,t)}static none(){return a.singletonNone}fold(t,n){return this.tag?n(this.value):t()}isSome(){return this.tag}isNone(){return!this.tag}map(t){return this.tag?a.some(t(this.value)):a.none()}bind(t){return this.tag?t(this.value):a.none()}exists(t){return this.tag&&t(this.value)}forall(t){return!this.tag||t(this.value)}filter(t){return!this.tag||t(this.value)?this:a.none()}getOr(t){return this.tag?this.value:t}or(t){return this.tag?this:t}getOrThunk(t){return this.tag?this.value:t()}orThunk(t){return this.tag?this:t()}getOrDie(t){if(this.tag)return this.value;throw new Error(t??"Called getOrDie on None")}static from(t){return C(t)?a.some(t):a.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(t){this.tag&&t(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}a.singletonNone=new a(!1);const U=(e,t)=>{for(let n=0,o=e.length;n<o;n++){const s=e[n];if(t(s,n))return!0}return!1},R=(e,t)=>{const n=e.length,o=new Array(n);for(let s=0;s<n;s++){const r=e[s];o[s]=t(r,s)}return o},z=(e,t)=>{for(let n=0,o=e.length;n<o;n++){const s=e[n];t(s,n)}},N=e=>{let t=e;return{get:()=>t,set:s=>{t=s}}},q=(e,t)=>{let n=null;const o=()=>{w(n)||(clearTimeout(n),n=null)};return{cancel:o,throttle:(...r)=>{o(),n=setTimeout(()=>{n=null,e.apply(null,r)},t)}}},B=(e,t)=>{e.insertContent(t)},O=Object.keys,G=Object.hasOwnProperty,S=(e,t)=>{const n=O(e);for(let o=0,s=n.length;o<s;o++){const r=n[o],i=e[r];t(i,r)}},W=(e,t)=>Y(e,(n,o)=>({k:o,v:t(n,o)})),Y=(e,t)=>{const n={};return S(e,(o,s)=>{const r=t(o,s);n[r.k]=r.v}),n},L=(e,t)=>G.call(e,t),H=(e=>(...t)=>{if(t.length===0)throw new Error("Can't merge zero objects");const n={};for(let o=0;o<t.length;o++){const s=t[o];for(const r in s)L(s,r)&&(n[r]=e(n[r],s[r]))}return n})((e,t)=>t),J=e=>{const t=N(a.none()),n=()=>t.get().each(e);return{clear:()=>{n(),t.set(a.none())},isSet:()=>t.get().isSome(),get:()=>t.get(),set:p=>{n(),t.set(a.some(p))}}},T=()=>{const e=J(I);return{...e,on:n=>e.get().each(n)}},K=(e,t,n)=>t===""||e.length>=t.length&&e.substr(n,n+t.length)===t,F=(e,t,n=0,o)=>{const s=e.indexOf(t,n);return s!==-1?d(o)?!0:s+t.length<=o:!1},Q=(e,t)=>K(e,t,0);var V=tinymce.util.Tools.resolve("tinymce.Resource");const X="tinymce.plugins.emoticons",E=e=>t=>t.options.get(e),Z=(e,t)=>{const n=e.options.register;n("emoticons_database",{processor:"string",default:"emojis"}),n("emoticons_database_url",{processor:"string",default:`${t}/js/${tt(e)}${e.suffix}.js`}),n("emoticons_database_id",{processor:"string",default:X}),n("emoticons_append",{processor:"object",default:{}}),n("emoticons_images_url",{processor:"string",default:"https://twemoji.maxcdn.com/v/13.0.1/72x72/"})},tt=E("emoticons_database"),et=E("emoticons_database_url"),nt=E("emoticons_database_id"),ot=E("emoticons_append"),st=E("emoticons_images_url"),A="All",rt={symbols:"Symbols",people:"People",animals_and_nature:"Animals and Nature",food_and_drink:"Food and Drink",activity:"Activity",travel_and_places:"Travel and Places",objects:"Objects",flags:"Flags",user:"User Defined"},at=(e,t)=>L(e,t)?e[t]:t,ct=e=>{const t=ot(e);return W(t,n=>({keywords:[],category:"user",...n}))},it=(e,t,n)=>{const o=T(),s=T(),r=st(e),i=c=>Q(c.char,"<img")?c.char.replace(/src="([^"]+)"/,(l,y)=>`src="${r}${y}"`):c.char,p=c=>{const l={},y=[];S(c,(v,pt)=>{const k={title:pt,keywords:v.keywords,char:i(v),category:at(rt,v.category)},yt=l[k.category]!==void 0?l[k.category]:[];l[k.category]=yt.concat([k]),y.push(k)}),o.set(l),s.set(y)};e.on("init",()=>{V.load(n,t).then(c=>{const l=ct(e);p(H(c,l))},c=>{console.log(`Failed to load emojis: ${c}`),o.set({}),s.set([])})});const D=c=>c===A?u():o.get().bind(l=>a.from(l[c])).getOr([]),u=()=>s.get().getOr([]),h=()=>[A].concat(O(o.get().getOr({}))),m=()=>g()?Promise.resolve(!0):new Promise((c,l)=>{let y=15;const v=setInterval(()=>{g()?(clearInterval(v),c(!0)):(y--,y<0&&(console.log("Could not load emojis from url: "+t),clearInterval(v),l(!1)))},100)}),g=()=>o.isSet()&&s.isSet();return{listCategories:h,hasLoaded:g,waitForLoad:m,listAll:u,listCategory:D}},lt=(e,t)=>F(e.title.toLowerCase(),t)||U(e.keywords,n=>F(n.toLowerCase(),t)),x=(e,t,n)=>{const o=[],s=t.toLowerCase(),r=n.fold(()=>M,i=>p=>p>=i);for(let i=0;i<e.length&&!((t.length===0||lt(e[i],s))&&(o.push({value:e[i].char,text:e[i].title,icon:e[i].char}),r(o.length)));i++);return o},_="pattern",ut=(e,t)=>{const n={pattern:"",results:x(t.listAll(),"",a.some(300))},o=N(A),s=h=>{const m=h.getData(),g=o.get(),c=t.listCategory(g),l=x(c,m[_],g===A?a.some(300):a.none());h.setData({results:l})},r=q(h=>{s(h)},200),i={label:"Search",type:"input",name:_},p={type:"collection",name:"results"},D=()=>({title:"Emojis",size:"normal",body:{type:"tabpanel",tabs:R(t.listCategories(),m=>({title:m,name:m,items:[i,p]}))},initialData:n,onTabChange:(m,g)=>{o.set(g.newTabName),r.throttle(m)},onChange:r.throttle,onAction:(m,g)=>{g.name==="results"&&(B(e,g.value),m.close())},buttons:[{type:"cancel",text:"Close",primary:!0}]}),u=e.windowManager.open(D());u.focus(_),t.hasLoaded()||(u.block("Loading emojis..."),t.waitForLoad().then(()=>{u.redial(D()),r.throttle(u),u.focus(_),u.unblock()}).catch(h=>{u.redial({title:"Emojis",body:{type:"panel",items:[{type:"alertbanner",level:"error",icon:"warning",text:"Could not load emojis"}]},buttons:[{type:"cancel",text:"Close",primary:!0}],initialData:{pattern:"",results:[]}}),u.focus(_),u.unblock()}))},gt=(e,t)=>{e.addCommand("mceEmoticons",()=>ut(e,t))},mt=e=>{e.on("PreInit",()=>{e.parser.addAttributeFilter("data-emoticon",t=>{z(t,n=>{n.attr("data-mce-resize","false"),n.attr("data-mce-placeholder","1")})})})},ht=(e,t)=>{e.ui.registry.addAutocompleter("emoticons",{trigger:":",columns:"auto",minChars:2,fetch:(n,o)=>t.waitForLoad().then(()=>{const s=t.listAll();return x(s,n,a.some(o))}),onAction:(n,o,s)=>{e.selection.setRng(o),e.insertContent(s),n.hide()}})},P=e=>t=>{const n=()=>{t.setEnabled(e.selection.isEditable())};return e.on("NodeChange",n),n(),()=>{e.off("NodeChange",n)}},dt=e=>{const t=()=>e.execCommand("mceEmoticons");e.ui.registry.addButton("emoticons",{tooltip:"Emojis",icon:"emoji",onAction:t,onSetup:P(e)}),e.ui.registry.addMenuItem("emoticons",{text:"Emojis...",icon:"emoji",onAction:t,onSetup:P(e)})};var ft=()=>{b.add("emoticons",(e,t)=>{Z(e,t);const n=et(e),o=nt(e),s=it(e,n,o);gt(e,s),dt(e),ht(e,s),mt(e)})};ft()})();const bt=vt({__proto__:null,default:$},[$]);exports.index=bt;
//# sourceMappingURL=index-BCypMMH9.cjs.map
